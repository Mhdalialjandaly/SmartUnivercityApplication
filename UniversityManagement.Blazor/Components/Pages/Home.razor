@page "/DashBoard"
@attribute [Authorize]
@inject IStudentServices StudentServices
@inject IEmployeeServices EmployeeServices
@inject ICourseServices CourseServices

<PageTitle>الجامعة الذكية - لوحة التحكم</PageTitle>

<style>
    :root {
        --primary-color: #4361ee;
        --secondary-color: #3f37c9;
        --success-color: #4cc9f0;
        --warning-color: #f8961e;
        --danger-color: #f72585;
        --dark-color: #1a1a2e;
        --light-color: #f8f9fa;
        --card-shadow: 0 10px 20px -5px rgba(0, 0, 0, 0.1);
        --card-hover-shadow: 0 15px 30px -5px rgba(0, 0, 0, 0.15);
    }

    .dashboard-container {
        padding: 1.5rem;
        background-color: #f5f7f9;
        min-height: 100vh;
    }

    .dashboard-header {
        background: white;
        border-radius: 12px;
        padding: 1.5rem;
        margin-bottom: 1.5rem;
        box-shadow: var(--card-shadow);
    }

    .welcome-title {
        font-size: 1.8rem;
        font-weight: 700;
        color: var(--dark-color);
        margin-bottom: 0.5rem;
    }

    .welcome-message {
        color: #6c757d;
        font-size: 1rem;
        margin-top: 0.5rem;
    }

    .stats-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
        gap: 20px;
        margin-bottom: 25px;
    }

    .stat-card {
        background: white;
        border-radius: 12px;
        padding: 1.5rem;
        box-shadow: var(--card-shadow);
        text-align: center;
        display: flex;
        flex-direction: column;
        position: relative;
        overflow: hidden;
    }

        .stat-card::before {
            content: '';
            position: absolute;
            top: 0;
            right: 0;
            width: 100%;
            height: 4px;
            background: linear-gradient(90deg, var(--card-color), var(--card-color-dark));
        }

    .stat-icon {
        font-size: 2.2rem;
        margin-bottom: 0.8rem;
        color: var(--card-color);
    }

    .stat-value {
        font-size: 2.2rem;
        font-weight: 700;
        color: var(--dark-color);
        margin-bottom: 0.5rem;
    }

    .stat-label {
        color: #6c757d;
        font-size: 0.95rem;
    }

    .dashboard {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
        gap: 25px;
    }

    .card {
        background: white;
        border-radius: 12px;
        padding: 1.8rem;
        box-shadow: var(--card-shadow);
        transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.1);
        text-align: right;
        text-decoration: none;
        color: var(--dark-color);
        display: flex;
        flex-direction: column;
        position: relative;
        overflow: hidden;
        border: none;
        min-height: 180px;
    }

        .card::before {
            content: '';
            position: absolute;
            top: 0;
            right: 0;
            width: 100%;
            height: 5px;
            background: linear-gradient(90deg, var(--card-color), var(--card-color-dark));
        }

        .card:hover {
            transform: translateY(-8px);
            box-shadow: var(--card-hover-shadow);
        }

    .card-content {
        display: flex;
        flex-direction: column;
        height: 100%;
    }

    .card-icon {
        font-size: 2.8rem;
        margin-bottom: 1.2rem;
        color: var(--card-color);
        align-self: flex-end;
    }

    .card-title {
        margin: 0.5rem 0;
        font-size: 1.4rem;
        font-weight: 600;
        color: var(--dark-color);
    }

    .card-description {
        color: #6c757d;
        font-size: 0.95rem;
        line-height: 1.5;
        margin-top: auto;
    }

    /* ألوان الكروت */
    .card-1 {
        --card-color: #4361ee;
        --card-color-dark: #3f37c9;
    }

    .card-2 {
        --card-color: #f72585;
        --card-color-dark: #b5179e;
    }

    .card-3 {
        --card-color: #4cc9f0;
        --card-color-dark: #4895ef;
    }

    .card-4 {
        --card-color: #f8961e;
        --card-color-dark: #f3722c;
    }

    .card-5 {
        --card-color: #7209b7;
        --card-color-dark: #560bad;
    }

    .card-6 {
        --card-color: #3a86ff;
        --card-color-dark: #2667cc;
    }

    .card-7 {
        --card-color: #06d6a0;
        --card-color-dark: #04a777;
    }

    .card-8 {
        --card-color: #8338ec;
        --card-color-dark: #5e2fca;
    }

    .card-9 {
        --card-color: #ff006e;
        --card-color-dark: #d00060;
    }

    .card-10 {
        --card-color: #1a936f;
        --card-color-dark: #114b3e;
    }

    .stat-1 {
        --card-color: #4361ee;
        --card-color-dark: #3f37c9;
    }

    .stat-2 {
        --card-color: #f72585;
        --card-color-dark: #b5179e;
    }

    .stat-3 {
        --card-color: #4cc9f0;
        --card-color-dark: #4895ef;
    }

    .stat-4 {
        --card-color: #f8961e;
        --card-color-dark: #f3722c;
    }

    .loading {
        display: flex;
        justify-content: center;
        align-items: center;
        height: 200px;
    }

    .spinner {
        width: 40px;
        height: 40px;
        border: 4px solid #f3f3f3;
        border-top: 4px solid var(--primary-color);
        border-radius: 50%;
        animation: spin 1s linear infinite;
    }

    @@keyframes spin {
        0% {
            transform: rotate(0deg);
        }

        100% {
            transform: rotate(360deg);
        }
    }

    @@media (max-width: 768px) {
        .dashboard {
            grid-template-columns: 1fr;
        }

        .stats-grid {
            grid-template-columns: 1fr;
        }
    }
</style>

	<div class="main-panel">
		<div class="content">
			<div class="page-inner">
<div class="dashboard-container">
    <div class="dashboard-header">
        <h1 class="welcome-title">مرحباً بك في نظام الجامعة الذكية</h1>
        <p class="welcome-message">هنا يمكنك إدارة جميع جوانب الجامعة من خلال لوحة التحكم المتكاملة</p>
    </div>

    @if (isLoading)
    {
        <div class="loading">
            <div class="spinner"></div>
        </div>
    }
    else
    {
        <div class="stats-grid">
            <div class="stat-card stat-1">
                <i class="fas fa-user-graduate stat-icon"></i>
                <div class="stat-value">@totalStudents</div>
                <div class="stat-label">إجمالي الطلاب</div>
            </div>

            <div class="stat-card stat-2">
                <i class="fas fa-chalkboard-teacher stat-icon"></i>
                <div class="stat-value">@totalEmployees</div>
                <div class="stat-label">الكادر التعليمي والإداري</div>
            </div>

            <div class="stat-card stat-3">
                <i class="fas fa-book stat-icon"></i>
                <div class="stat-value">@totalCourses</div>
                <div class="stat-label">المقررات الدراسية</div>
            </div>

            <div class="stat-card stat-4">
                <i class="fas fa-chart-line stat-icon"></i>
                <div class="stat-value">@activeStudents</div>
                <div class="stat-label">طلاب نشطين</div>
            </div>
        </div>

        <div class="dashboard">
            <!-- كرت 1 -->
            <a href="/students-managment" class="card card-1">
                <div class="card-content">
                    <i class="fas fa-users card-icon"></i>
                    <h3 class="card-title">شؤون الطلاب</h3>
                    <p class="card-description">إدارة بيانات الطلاب، التسجيلات، الشهادات والمتابعة الأكاديمية</p>
                </div>
            </a>

            <!-- كرت 2 -->
            <a href="/hr/attendance" class="card card-2">
                <div class="card-content">
                    <i class="fas fa-chalkboard-teacher card-icon"></i>
                    <h3 class="card-title">إدارة الكادر التعليمي</h3>
                    <p class="card-description">إدارة المدرسين، توزيع المواد، الجداول الدراسية والتقييمات</p>
                </div>
            </a>

            <!-- كرت 3 -->
            <a href="/academic-calendar" class="card card-3">
                <div class="card-content">
                    <i class="fas fa-book card-icon"></i>
                    <h3 class="card-title">النظام الأكاديمي</h3>
                    <p class="card-description">إدارة المواد الدراسية، الخطط الأكاديمية والجداول الزمنية</p>
                </div>
            </a>

            <!-- كرت 4 -->
            <a href="/financial-management" class="card card-4">
                <div class="card-content">
                    <i class="fas fa-money-bill-wave card-icon"></i>
                    <h3 class="card-title">الشؤون المالية</h3>
                    <p class="card-description">إدارة الرسوم الدراسية، المنح، الرواتب والحسابات المالية</p>
                </div>
            </a>

            <!-- كرت 5 -->
            <a href="/admin/documents" class="card card-5">
                <div class="card-content">
                    <i class="fas fa-file-alt card-icon"></i>
                    <h3 class="card-title">شؤون الكتب الرسمية</h3>
                    <p class="card-description">إدارة الوثائق الرسمية، الشهادات والسجلات الأكاديمية</p>
                </div>
            </a>

            <!-- كرت 6 -->
            <a href="/academic-calendar" class="card card-6">
                <div class="card-content">
                    <i class="fas fa-calendar-alt card-icon"></i>
                    <h3 class="card-title">الجدول الزمني</h3>
                    <p class="card-description">إدارة المحاضرات، الامتحانات والفعاليات الجامعية</p>
                </div>
            </a>

            <!-- كرت 7 -->
            <a href="/finance/reports" class="card card-7">
                <div class="card-content">
                    <i class="fas fa-chart-line card-icon"></i>
                    <h3 class="card-title">التقارير والإحصائيات</h3>
                    <p class="card-description">تقارير أداء الطلاب، الإحصائيات الأكاديمية والمالية</p>
                </div>
            </a>

            <!-- كرت 8 -->
            <a href="/admin/applications" class="card card-8">
                <div class="card-content">
                    <i class="fas fa-user-graduate card-icon"></i>
                    <h3 class="card-title">إدارة الطلاب والتسجيلات</h3>
                    <p class="card-description">إدارة طلبات التسجيل والقبول الأكاديمي</p>
                </div>
            </a>

            <!-- كرت 9 -->
            <a href="departments/notifications.html" class="card card-9">
                <div class="card-content">
                    <i class="fas fa-bell card-icon"></i>
                    <h3 class="card-title">نظام الإشعارات</h3>
                    <p class="card-description">إرسال تنبيهات للطلاب والمدرسين حول المستجدات</p>
                </div>
            </a>

            <!-- كرت 10 -->
            <a asp-action="index" asp-controller="settings" class="card card-10">
                <div class="card-content">
                    <i class="fas fa-cog card-icon"></i>
                    <h3 class="card-title">الإعدادات</h3>
                    <p class="card-description">تخصيص النظام، إعدادات المستخدم وإدارة الصلاحيات</p>
                </div>
            </a>
        </div>
    }
</div>
        </div>
    </div>
</div>
@code {
    private bool isLoading = true;
    private int totalStudents = 0;
    private int totalEmployees = 0;
    private int totalCourses = 0;
    private int activeStudents = 0;

    protected override async Task OnInitializedAsync()
    {
        try
        {
            // جلب البيانات من الخدمات
            var studentsCountTask = StudentServices.GetTotalStudentsCountAsync();
            var employeesTask = EmployeeServices.GetAllAsync();
            var coursesCountTask = CourseServices.GetCoursesCountAsync();
            var activeStudentsTask = StudentServices.GetActiveStudentsCountAsync();

            await Task.WhenAll(studentsCountTask, employeesTask, coursesCountTask, activeStudentsTask);

            totalStudents = await studentsCountTask;
            var employees = await employeesTask;
            totalEmployees = employees?.Count ?? 0;
            totalCourses = await coursesCountTask;
            activeStudents = await activeStudentsTask;
        }
        catch (Exception ex)
        {
            // يمكن إضافة خدمة تسجيل الأخطاء هنا
            Console.WriteLine($"Error loading dashboard data: {ex.Message}");
        }
        finally
        {
            isLoading = false;
        }
    }
}